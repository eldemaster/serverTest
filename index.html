<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Modifica profilo</title>
  </head>
  <body>
    <h1>Modifica profilo</h1>
    <form>
      <label for="nome">Nome:</label>
      <input type="text" id="nome" name="nome" value="Mario" disabled>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" value="mario@example.com" disabled>

      <label for="interessi">Interessi:</label>
      <textarea id="interessi" name="interessi" disabled>Sport, viaggi, musica</textarea>

      <button id="modifica" type="button">Modifica</button>
      <button id="salva" type="button" disabled>Salva</button>
    </form>

    <script>
      const modificaBtn = document.querySelector('#modifica');
      const salvaBtn = document.querySelector('#salva');
      const nomeInput = document.querySelector('#nome');
      const emailInput = document.querySelector('#email');
      const interessiTextarea = document.querySelector('#interessi');

      modificaBtn.addEventListener('click', () => {
        nomeInput.disabled = false;
        emailInput.disabled = false;
        interessiTextarea.disabled = false;

        modificaBtn.disabled = true;
        salvaBtn.disabled = false;
      });

      salvaBtn.addEventListener('click', () => {
        const nome = nomeInput.value;
        const email = emailInput.value;
        const interessi = interessiTextarea.value;

        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/salva');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = () => {
          if (xhr.status === 200) {
            console.log(`Salvato il profilo di ${nome} (${email}): ${interessi}`);

            nomeInput.disabled = true;
            emailInput.disabled = true;
            interessiTextarea.disabled = true;

            modificaBtn.disabled = false;
            salvaBtn.disabled = true;
          } else {
            console.error(`Errore durante il salvataggio del profilo: ${xhr.status}`);
          }
        };
        xhr.send(`nome=${encodeURIComponent(nome)}&email=${encodeURIComponent(email)}&interessi=${encodeURIComponent(interessi)}`);
      });
    </script>
  </body>
</html>
